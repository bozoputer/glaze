function I(t,e,n=!1){var r;let i="string"!=typeof e?null==(r=null==e?void 0:e.selector)?void 0:r.value:"";if(i){if(i=i.replaceAll("_"," "),i.startsWith("&")){const e=null==i?void 0:i.replace("&",":scope");return n?t.querySelector(e):t.querySelectorAll(e)}return i}return t}function x(t){return!(null===t||"object"!=typeof t||Array.isArray(t)||t instanceof HTMLElement)}function T(t,...e){if(!e.length)return t;const n=e.shift();if(x(t)&&x(n))for(const e in n)"__proto__"===e||"constructor"===e||"prototype"===e||(x(n[e])?(t[e]||Object.assign(t,{[e]:{}}),T(t[e],n[e])):Object.assign(t,{[e]:n[e]}));return e.length?T(t,...e):t}function N(t){const e=t.match(/^\[([^\]]+)]:(.*)/);return e?{content:e[1],restOfString:e[2]}:null}function V(t,e,n){if("string"!=typeof t)return t;const r=t.replace(/^\[|]$/g,"").replaceAll("_"," ");return r.startsWith("&")?I(e,t,["trigger"].includes(n)):"true"===r||"false"===r?"true"===r:isNaN(Number(r))?r:r.includes(".")?parseFloat(r):parseInt(r,10)}function F(t,e=!1,n){const r={};return t.split(" ").forEach((t=>{var i;const l=N(t);l&&(t=l.restOfString,r.selector={},r.selector.value=l.content);const o=t.split(":").filter((t=>!t.includes("@"))),[u,a]=o;if(!a&&e){const e=t.split("-"),i=e[0],l=e[1];if(!i||!l)return;return void(r[i]=V(l,n,i))}if("tl"===u&&a.startsWith("["))return void(r.tl={value:null==(i=N(a+":"))?void 0:i.content});if(!a)return;const s=a.split("|");r[u]||(r[u]={}),s.forEach((t=>{if(!t)return;let[e,i]=t.split(/-(.+)/);i=V(i,n,e);const l=e.split(".");let o=r[u];l.forEach(((t,e)=>{e===l.length-1?o[t]=i:(o[t]||(o[t]={}),o=o[t])}))}))})),r}function K(t,e,n){const r=t.match(/(?:@(\w+):)?tl(?:\/(\w+))?/);if(r){const t=r[1],i={id:r[2]??"",breakpoint:n};if(t){if(null==e||!e[t])return null;i.breakpoint=e[t]??n}return i}return null}function L(t,e,n){const r={};return t.split(" ").forEach((t=>{const i=t.match(/@(\w+):/);if(!i)return r[n]||(r[n]=[]),void r[n].push(t);const l=i[1],o=null==e?void 0:e[l];o&&(r[o]||(r[o]=[]),r[o].push(t.replace(i[0],"")))})),r}function Q(t,e){let n=null;return function(...r){null!==n&&clearTimeout(n),n=window.setTimeout((()=>{t(...r)}),e)}}function J(t){var e,n;if(!t||null==(n=null==(e=null==t?void 0:t.lib)?void 0:e.gsap)||!n.core)throw new Error("GSAP not found");const{lib:{gsap:{core:r}},...i}=t,l=T({breakpoints:{default:"(min-width: 1px)"},dataAttribute:"data-animate",element:document,watch:!1},i),o=l.breakpoints.default,u=l.breakpoints,a=[],s=t=>(t.getAttribute(f())||"").trim(),c=(t=l.element)=>Array.from(t.querySelectorAll(f(!0))),f=(t=!1)=>`${t?"[":""}${l.dataAttribute}${t?"]":""}`,d=()=>Math.random().toString(36).substring(2,15),p=t=>"tl"===t||t.includes("tl/")||t.endsWith(":tl"),m=t=>a.find((e=>e.elements.has(t))),b=t=>a.findIndex((e=>e.elements.has(t))),h=Q((function(t){const e=m(t.target),n=b(t.target);n>-1&&null!=e&&e.timeline&&(e.timeline.progress(0),e.timeline.kill(),a.splice(n,1),k([...Array.from(e.elements.keys()),...null!=e&&e.timelineElement?[null==e?void 0:e.timelineElement]:[]],!0))}),"object"==typeof l.watch?l.watch.debounceTime||5e3:500);function v(t){const e=[...Object.entries(L(s(t),u,o)).map((([e,n])=>({breakpoint:e,element:t,data:F(n.join(" "),!1,t)})))],n={};return e.forEach((t=>{null!=n&&n[t.breakpoint]||(n[t.breakpoint]={}),n[t.breakpoint]=t.data})),n}function g(t=c()){const e=[];t.forEach((t=>{s(t).split(" ").some((t=>p(t)))&&(e.push(...function(t){const e=[],n=s(t),r=n.split(" ");if(r.some((t=>p(t)))){const i=K(n,u,o),s=new Map;[...c(t),...null!=i&&i.id?document.querySelectorAll(`[${l.dataAttribute}*="tl:${i.id}"]`):[]].forEach((t=>{s.set(t,v(t)),e.push(t)}));const f=F(r.filter((t=>!p(t))).join(" "),!0,t),m=(null==i?void 0:i.breakpoint)||o;a.push({breakpoint:m,data:f,elements:s,id:(null==i?void 0:i.id)||d(),timelineElement:t})}return e}(t)),e.push(t))})),t.forEach((t=>{var n;if(e.includes(t))return;const r=null==(n=a.find((e=>{var n;return(null==(n=e.elements)?void 0:n.has(t))&&e.breakpoint})))?void 0:n.breakpoint,i=a.find((e=>{var n;return null==(n=e.elements)?void 0:n.has(t)})),l=new Map;i||(l.set(t,v(t)),a.push({breakpoint:r||o,data:{},elements:l,id:d()}))}))}function k(t=c(),e=!1){g(t),r.matchMedia().add(Object.fromEntries(Object.values({[o]:o,...u||{}}).map((t=>[t,t]))),(t=>{const n={};(e?[a[a.length-1]]:a).reduce(((t,e)=>new Map([...t,...e.elements])),new Map).forEach(((e,i)=>{let l={};Object.entries(e).forEach((([e,n])=>{var r;null!=(r=t.conditions)&&r[e]&&(l=T(l,n))}));const o=m(i),u=b(i);o&&(null!=n&&n[null==o?void 0:o.id]||(n[null==o?void 0:o.id]=r.timeline(null==o?void 0:o.data),a[u].timeline=n[null==o?void 0:o.id]),function(t,e,n){var r;const i=e.tl?null==(r=Object.values(e.tl))?void 0:r[0]:void 0;if(e.to&&e.from)n.fromTo(I(t,e),e.from,e.to,i);else if(e.to||e.from){const r=e.to?"to":"from";n[r](I(t,e),e[r],i)}}(i,l,n[null==o?void 0:o.id]))}))}))}return k(),l.watch&&function(){const t=l.element,e=new MutationObserver((function(t){t.forEach((function(t){"attributes"===t.type&&t.attributeName===l.dataAttribute&&h(t)}))})),n={attributes:!0,attributeFilter:[l.dataAttribute],subtree:!0};e.observe(t,n)}(),{breakpoints:u,state:l,timelines:a}}export{J as default};