(function(l,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(l=typeof globalThis<"u"?globalThis:l||self,h(l.Glaze={}))})(this,function(l){"use strict";var y=Object.defineProperty;var A=(l,h,n)=>h in l?y(l,h,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[h]=n;var u=(l,h,n)=>(A(l,typeof h!="symbol"?h+"":h,n),n);const n=class n{static isObject(e){return e&&typeof e=="object"&&!Array.isArray(e)}static mergeDeep(e,...i){if(!i.length)return e;const s=i.shift();if(this.isObject(e)&&this.isObject(s))for(const t in s)this.isObject(s[t])?(e[t]||Object.assign(e,{[t]:{}}),this.mergeDeep(e[t],s[t])):Object.assign(e,{[t]:s[t]});return i.length?this.mergeDeep(e,...i):e}static adjustValuesByKey(e,i,s){Object.keys(e).forEach(t=>{i.includes(t)?e[t]=s(e[t]):typeof e[t]=="object"&&e[t]!==null&&!Array.isArray(e[t])?this.adjustValuesByKey(e[t],i,s):Array.isArray(e[t])&&e[t].forEach(c=>{typeof c=="object"&&c!==null&&this.adjustValuesByKey(c,i,s)})})}static generateUniqueId(){return Math.random().toString(36).substring(2,15)}static getSelectorFromBracket(e){const i=/^\[([^\]]+)]:(.*)/,s=e.match(i);return s?{content:s[1],restOfString:s[2]}:null}static castValue(e){if(typeof e!="string")return e;const i=e.replace(/^\[|]$/g,"");return i==="true"||i==="false"?i==="true":isNaN(Number(i))?i:i.includes(".")?parseFloat(i):parseInt(i,10)}static parseTimeline(e){var t;const i=/(?:@(\w+):)?tl(?:\/(\w+))?/,s=e.match(i);if(s){const c=s[1],o={id:s[2]??"",matchMedia:this.bp};if(c){if(!((t=this.matchMedias)!=null&&t[c]))return null;o.matchMedia=this.matchMedias[c]}return o}else return null}static parseMediaQueries(e){const i={};return e.split(" ").forEach(t=>{var o;const c=t.match(/@(\w+):/);if(!c){i[this.bp]||(i[this.bp]=[]),i[this.bp].push(t);return}const r=c[1];(o=this.matchMedias)!=null&&o[r]&&(i[this.matchMedias[r]]||(i[this.matchMedias[r]]=[]),i[this.matchMedias[r]].push(t.replace(c[0],"")))}),i}static parseToObject(e,i=!1){const s={};return e.split(" ").forEach(c=>{var b;const r=this.getSelectorFromBracket(c);r&&(c=r.restOfString,s.selector={},s.selector.value=r.content);const o=c.split(":").filter(f=>!f.includes("@")),[a,p]=o;if(!p&&i){const f=c.split("-"),M=f[0],d=f[1];if(!M||!d)return;s[M]=this.castValue(d);return}if(a==="tl"&&p.startsWith("[")){s.tl={value:(b=this.getSelectorFromBracket(p+":"))==null?void 0:b.content};return}const m=p.split("|");s[a]||(s[a]={}),m.forEach(f=>{if(!f)return;let[M,d]=f.split(/-(.+)/);d=this.castValue(d);const E=M.split(".");let g=s[a];E.forEach((O,S)=>{S===E.length-1?g[O]=d:(g[O]||(g[O]={}),g=g[O])})})}),s}static collect(){const e=[],i=this.getElements();i.forEach(s=>{const t=this.getAttribute(s),c=t.split(" ");if(c.some(r=>r==="tl"||r.includes("tl/")||r.endsWith(":tl"))){const r=this.parseTimeline(t),o=[];[...this.getElements(s),...r!=null&&r.id?document.querySelectorAll(`[${this.config.dataAttribute}*="tl:${r.id}"]`):[]].forEach(a=>{o.push(a)}),e.push(s),this.timelines.push({id:(r==null?void 0:r.id)||this.generateUniqueId(),data:this.parseToObject(c.filter(a=>a!=="tl"&&!a.includes("tl/")&&!a.endsWith(":tl")).join(" "),!0),matchMedia:(r==null?void 0:r.matchMedia)||this.bp,elements:o});return}}),i.forEach(s=>{var c;if(e.includes(s))return;const t=(c=this.timelines.find(r=>r.elements.some(o=>o===s)&&r.matchMedia))==null?void 0:c.matchMedia;this.elements.push(...Object.entries(this.parseMediaQueries(this.getAttribute(s))).map(([r,o])=>({matchMedia:r??t,element:s,data:this.parseToObject(o.join(" "))})))}),this.elements.forEach(s=>{this.data.has(s.element)||this.data.set(s.element,{});const t={[s.matchMedia]:s.data};this.data.set(s.element,{...this.data.get(s.element),...t})})}static init(){const e=this.gsap.matchMedia(),i=(s,t,c)=>{var o;const r=t.tl?(o=Object.values(t.tl))==null?void 0:o[0]:void 0;if(t.to&&t.from){c?c.fromTo(this.getSelectorOrElement(s,t),t.from,t.to,r):this.gsap.fromTo(this.getSelectorOrElement(s,t),t.from,t.to);return}if(t.to||t.from){const a=t.to?"to":"from";c?c[a](this.getSelectorOrElement(s,t),t[a],r):this.gsap[a](this.getSelectorOrElement(s,t),t[a])}};e.add(Object.fromEntries(Object.values({[this.bp]:this.bp,...this.matchMedias||{}}).map(s=>[s,s])),s=>{const t=[];this.timelines.forEach(c=>{const r=this.gsap.timeline(c.data||{});t.push({elements:c.elements,timeline:r})}),this.data.forEach((c,r)=>{var p;let o={};Object.entries(c).forEach(([m,b])=>{var f;(f=s.conditions)!=null&&f[m]&&(o=this.mergeDeep(o,b))}),this.adjustValuesByKey(o,["trigger"],m=>this.getSelectorOrElement(r,m,!0));const a=(p=t.find(({elements:m})=>m.includes(r)))==null?void 0:p.timeline;i(r,o,a)})})}constructor(e){if(!e.gsap.core){console.error("Glaze: GSAP is not defined");return}return n.config={...n.config,...e},n.matchMedias=e.breakpoints,n.gsap=e.gsap.core,n.collect(),n.init(),{gsap:n.gsap,config:n.config,matchMedias:n.matchMedias,elements:n.elements,timelines:n.timelines,data:n.data}}};u(n,"bp","(min-width: 1px)"),u(n,"gsap"),u(n,"config",{dataAttribute:"data-animate"}),u(n,"matchMedias",{}),u(n,"elements",[]),u(n,"timelines",[]),u(n,"data",new Map),u(n,"getAttributeString",(e=!1)=>`${e?"[":""}${n.config.dataAttribute}${e?"]":""}`),u(n,"getAttribute",e=>(e.getAttribute(n.getAttributeString())||"").trim()),u(n,"getElements",(e=document)=>e.querySelectorAll(n.getAttributeString(!0))),u(n,"getSelectorOrElement",(e,i,s=!1)=>{var c;const t=typeof i!="string"?(c=i==null?void 0:i.selector)==null?void 0:c.value:"";if(t){if(t.startsWith("&")){const o=t==null?void 0:t.replace("&",":scope");return s?e.querySelector(o):e.querySelectorAll(o)}return t}return e});let h=n;l.Glaze=h,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
