(function(u,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(u=typeof globalThis<"u"?globalThis:u||self,h(u.Glaze={}))})(this,function(u){"use strict";var S=Object.defineProperty;var A=(u,h,n)=>h in u?S(u,h,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[h]=n;var f=(u,h,n)=>(A(u,typeof h!="symbol"?h+"":h,n),n);const n=class n{static isObject(s){return s&&typeof s=="object"&&!Array.isArray(s)}static mergeDeep(s,...i){if(!i.length)return s;const e=i.shift();if(this.isObject(s)&&this.isObject(e))for(const t in e)this.isObject(e[t])?(s[t]||Object.assign(s,{[t]:{}}),this.mergeDeep(s[t],e[t])):Object.assign(s,{[t]:e[t]});return i.length?this.mergeDeep(s,...i):s}static adjustValuesByKey(s,i,e){Object.keys(s).forEach(t=>{i.includes(t)?s[t]=e(s[t]):typeof s[t]=="object"&&s[t]!==null&&!Array.isArray(s[t])?this.adjustValuesByKey(s[t],i,e):Array.isArray(s[t])&&s[t].forEach(c=>{typeof c=="object"&&c!==null&&this.adjustValuesByKey(c,i,e)})})}static generateUniqueId(){return Math.random().toString(36).substring(2,15)}static getSelectorFromBracket(s){const i=/^\[([^\]]+)]:(.*)/,e=s.match(i);return e?{content:e[1],restOfString:e[2]}:null}static castValue(s){if(typeof s!="string")return s;const i=s.replace(/^\[|]$/g,"");return i==="true"||i==="false"?i==="true":isNaN(Number(i))?i:i.includes(".")?parseFloat(i):parseInt(i,10)}static parseTimeline(s){var t;const i=/(?:@(\w+):)?tl(?:\/(\w+))?/,e=s.match(i);if(e){const c=e[1],o={id:e[2]??"",matchMedia:this.bp};if(c){if(!((t=this.matchMedias)!=null&&t[c]))return null;o.matchMedia=this.matchMedias[c]}return o}else return null}static parseMediaQueries(s){const i={};return s.split(" ").forEach(t=>{var o;const c=t.match(/@(\w+):/);if(!c){i[this.bp]||(i[this.bp]=[]),i[this.bp].push(t);return}const r=c[1];(o=this.matchMedias)!=null&&o[r]&&(i[this.matchMedias[r]]||(i[this.matchMedias[r]]=[]),i[this.matchMedias[r]].push(t.replace(c[0],"")))}),i}static parseToObject(s,i=!1){const e={};return s.split(" ").forEach(c=>{var b;const r=this.getSelectorFromBracket(c);r&&(c=r.restOfString,e.selector={},e.selector.value=r.content);const o=c.split(":").filter(p=>!p.includes("@")),[l,a]=o;if(!a&&i){const p=c.split("-"),M=p[0],m=p[1];if(!M||!m)return;e[M]=this.castValue(m);return}if(l==="tl"&&a.startsWith("[")){e.tl={value:(b=this.getSelectorFromBracket(a+":"))==null?void 0:b.content};return}if(!a)return;const d=a.split("|");e[l]||(e[l]={}),d.forEach(p=>{if(!p)return;let[M,m]=p.split(/-(.+)/);m=this.castValue(m);const y=M.split(".");let g=e[l];y.forEach((O,E)=>{E===y.length-1?g[O]=m:(g[O]||(g[O]={}),g=g[O])})})}),e}static collect(){const s=[],i=this.getElements();i.forEach(e=>{const t=this.getAttribute(e),c=t.split(" ");if(c.some(r=>r==="tl"||r.includes("tl/")||r.endsWith(":tl"))){const r=this.parseTimeline(t),o=[];[...this.getElements(e),...r!=null&&r.id?document.querySelectorAll(`[${this.config.dataAttribute}*="tl:${r.id}"]`):[]].forEach(a=>{o.push(a)});const l=this.parseToObject(c.filter(a=>a!=="tl"&&!a.includes("tl/")&&!a.endsWith(":tl")).join(" "),!0);this.adjustValuesByKey(l,["trigger"],a=>this.getSelectorOrElement(e,a,!0)),s.push(e),this.timelines.push({id:(r==null?void 0:r.id)||this.generateUniqueId(),data:l,matchMedia:(r==null?void 0:r.matchMedia)||this.bp,elements:o});return}}),i.forEach(e=>{var c;if(s.includes(e))return;const t=(c=this.timelines.find(r=>r.elements.some(o=>o===e)&&r.matchMedia))==null?void 0:c.matchMedia;this.elements.push(...Object.entries(this.parseMediaQueries(this.getAttribute(e))).map(([r,o])=>({matchMedia:r??t,element:e,data:this.parseToObject(o.join(" "))})))}),this.elements.forEach(e=>{this.data.has(e.element)||this.data.set(e.element,{});const t={[e.matchMedia]:e.data};this.data.set(e.element,{...this.data.get(e.element),...t})})}static init(){const s=this.gsap.matchMedia(),i=(e,t,c)=>{var o;const r=t.tl?(o=Object.values(t.tl))==null?void 0:o[0]:void 0;if(t.to&&t.from){c?c.fromTo(this.getSelectorOrElement(e,t),t.from,t.to,r):this.gsap.fromTo(this.getSelectorOrElement(e,t),t.from,t.to);return}if(t.to||t.from){const l=t.to?"to":"from";c?c[l](this.getSelectorOrElement(e,t),t[l],r):this.gsap[l](this.getSelectorOrElement(e,t),t[l])}};s.add(Object.fromEntries(Object.values({[this.bp]:this.bp,...this.matchMedias||{}}).map(e=>[e,e])),e=>{const t=[];this.timelines.forEach(c=>{const r=this.gsap.timeline(c.data||{});t.push({elements:c.elements,timeline:r})}),this.data.forEach((c,r)=>{var a;let o={};Object.entries(c).forEach(([d,b])=>{var p;(p=e.conditions)!=null&&p[d]&&(o=this.mergeDeep(o,b))}),this.adjustValuesByKey(o,["trigger"],d=>this.getSelectorOrElement(r,d,!0));const l=(a=t.find(({elements:d})=>d.includes(r)))==null?void 0:a.timeline;i(r,o,l)})})}constructor(s){if(!s.gsap.core){console.error("Glaze: GSAP is not defined");return}return n.config={...n.config,...s},n.matchMedias=s.breakpoints,n.gsap=s.gsap.core,n.collect(),n.init(),{gsap:n.gsap,config:n.config,matchMedias:n.matchMedias,elements:n.elements,timelines:n.timelines,data:n.data}}};f(n,"bp","(min-width: 1px)"),f(n,"gsap"),f(n,"config",{dataAttribute:"data-animate"}),f(n,"matchMedias",{}),f(n,"elements",[]),f(n,"timelines",[]),f(n,"data",new Map),f(n,"getAttributeString",(s=!1)=>`${s?"[":""}${n.config.dataAttribute}${s?"]":""}`),f(n,"getAttribute",s=>(s.getAttribute(n.getAttributeString())||"").trim()),f(n,"getElements",(s=document)=>s.querySelectorAll(n.getAttributeString(!0))),f(n,"getSelectorOrElement",(s,i,e=!1)=>{var c;const t=typeof i!="string"?(c=i==null?void 0:i.selector)==null?void 0:c.value:"";if(t){if(t.startsWith("&")){const o=t==null?void 0:t.replace("&",":scope");return e?s.querySelector(o):s.querySelectorAll(o)}return t}return s});let h=n;u.Glaze=h,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})});
